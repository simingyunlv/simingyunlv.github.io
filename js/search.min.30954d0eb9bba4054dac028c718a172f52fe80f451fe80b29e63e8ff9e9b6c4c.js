(function(){const s=window.SIMING&&SIMING.indexPath||document.querySelector('meta[name="search-index-path"]')?.content||"/index.zh.json";function o(e){return/^[\x00-\x7F]+$/.test(e)}function e(e){return(e||"").toLowerCase()}function t(e){return window.Pinyin&&typeof window.Pinyin.convertToPinyin=="function"?window.Pinyin.convertToPinyin(e," ",!0):window.tinyPinyin&&tinyPinyin.convertToPinyin?tinyPinyin.convertToPinyin(e," "):e}async function i(){const e=await fetch(s,{credentials:"same-origin"});return await e.json()}function a(n,s){const a=e(s),r=[n.title,n.author,(n.tags||[]).join(" "),n.summary,n.content];let i=!1;if(o(a)){const o=e(t(n.title)).replace(/\s+/g,""),c=e(t(n.author)).replace(/\s+/g,""),l=e(t((n.tags||[]).join(" "))).replace(/\s+/g,""),s=a.replace(/\s+/g,"");i=o.includes(s)||c.includes(s)||l.includes(s),i||(i=r.some(t=>e(t).includes(a)))}else i=r.some(t=>e(t).includes(a));return i}function n(e){const t=document.getElementById("results"),n=document.getElementById("search-stats");t.innerHTML="",e.forEach(e=>{const n=document.createElement("li");n.innerHTML=`<a href="${e.permalink}"><strong>${e.title}</strong></a><br><small>${e.section} · ${e.date} · ${e.author}</small><br>${(e.summary||"").substring(0,120)}`,t.appendChild(n)}),n.textContent=`共 ${e.length} 条结果`}function r(){const e=new URLSearchParams(location.search);return e.get("q")||""}document.addEventListener("DOMContentLoaded",async()=>{const o=await i(),c=document.getElementById("search-form"),e=document.getElementById("q"),t=r();t&&(e.value=t);const s=()=>{const t=e.value.trim();if(!t){n([]);return}const s=o.filter(e=>a(e,t)).slice(0,50);n(s)};c?.addEventListener("submit",e=>{e.preventDefault(),s()}),e?.addEventListener("input",()=>{e.value.length>=1?s():n([])}),t&&s()})})()